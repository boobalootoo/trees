<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tree Cards Printable</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
    }
    .page {
      width: 210mm;
      height: 297mm;
      page-break-after: always;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-evenly;
      align-content: space-evenly;
      padding: 10mm;
      box-sizing: border-box;
      background: white;
    }
    .card {
      width: 60mm;
      height: 88mm;
      border: 1px solid #333;
      box-sizing: border-box;
      padding: 3mm;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      font-size: 8pt;
      overflow: hidden;
    }
    .card img {
      width: 100%;
      height: auto;
      object-fit: contain;
      margin-bottom: 5px;
    }
    .category {
      font-weight: bold;
      margin-top: 3px;
    }
    .value {
      margin-bottom: 2px;
      word-wrap: break-word;
      width: 100%;
    }
    @media print {
      body {
        margin: 0;
      }
      #header {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div id="header">
    <h1>Tree Card Generator (Printable)</h1>
    <button onclick="window.print()">Print or Save as PDF</button>
  </div>
  <div id="content"></div>

  <script>
    async function loadImage(url) {
      return new Promise((resolve) => {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = () => resolve(url);
        img.onerror = () => resolve('https://placehold.co/300x400?text=No+Image');
        img.src = url;
      });
    }

    (async function createCards() {
      const csvUrl = 'https://raw.githubusercontent.com/boobalootoo/trees/main/treespreadsheet.csv';
      const imageBase = 'https://raw.githubusercontent.com/boobalootoo/trees/refs/heads/main/';

      const response = await fetch(csvUrl);
      const csvText = await response.text();
      const lines = csvText.split('\n').filter(l => l.trim() !== '');
      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());

      const data = lines.slice(1).map(line => {
        const values = [];
        let inQuote = false, current = '';
        for (let char of line) {
          if (char === '"') inQuote = !inQuote;
          else if (char === ',' && !inQuote) {
            values.push(current.trim());
            current = '';
          } else current += char;
        }
        values.push(current.trim());
        let row = {};
        headers.forEach((h, i) => { row[h] = values[i]; });
        return row;
      });

      const content = document.getElementById('content');
      let cardCount = 0;
      let imgPage, infoPage;

      for (const tree of data) {
        if (cardCount % 9 === 0) {
          imgPage = document.createElement('div');
          imgPage.className = 'page';
          content.appendChild(imgPage);

          infoPage = document.createElement('div');
          infoPage.className = 'page';
          content.appendChild(infoPage);
        }

        const imageName = (tree.name || '').replace(/[\s-]/g, '').toLowerCase();
        const imgUrl = `${imageBase}${imageName}.png`;
        const finalImgUrl = await loadImage(imgUrl);

        // Image card
        const cardImg = document.createElement('div');
        cardImg.className = 'card';
        const img = document.createElement('img');
        img.src = finalImgUrl;
        img.alt = tree.name;
        cardImg.appendChild(img);
        imgPage.appendChild(cardImg);

        // Info card
        const cardInfo = document.createElement('div');
        cardInfo.className = 'card';
        cardInfo.innerHTML = `
          <div class="category">Name</div><div class="value">${tree.name || ''}</div>
          <div class="category">Native?</div><div class="value">${tree['native?'] || ''}</div>
          <div class="category">Size & Shape</div><div class="value">${tree['tree size and shape'] || ''}</div>
          <div class="category">Leaf</div><div class="value">${tree['leaf size and shape'] || ''}</div>
          <div class="category">Type</div><div class="value">${tree['tree type'] || ''}</div>
          <div class="category">Produces</div><div class="value">${tree['what it produces'] || ''}</div>
          <div class="category">Importance</div><div class="value">${tree['importance to other species and the environment'] || ''}</div>
          <div class="category">Look-alikes</div><div class="value">${tree['look-alikes'] || ''}</div>
        `;
        infoPage.appendChild(cardInfo);

        cardCount++;
      }
    })();
  </script>
</body>
</html>
